/* This pipeline requires the following plugins:
     Git: https://plugins.jenkins.io/git/
     Workflow Aggregator: https://plugins.jenkins.io/workflow-aggregator/
     JUnit: https://plugins.jenkins.io/junit/
     Allure: https://plugins.jenkins.io/allure-jenkins-plugin/
     Docker Pipeline: https://plugins.jenkins.io/docker-workflow/
*/

pipeline {
    agent { docker { image 'php:8.3.9-alpine3.20' } }
    stages {
        stage('build') {
            steps {
                sh 'php --version'
            }
        }
        stage('Checkout') {
            steps {
                script {
                    checkout([$class: 'GitSCM', branches: [[name: '*/master']], userRemoteConfigs: [[url: 'https://github.com/SilberWitch/Sybil.git']]])
                }
            }
        }
        stage('Test') {
            steps {
                sh(script: './mvnw --batch-mode -Dmaven.test.failure.ignore=true test')

            }
            }
        stage('Package') {
            steps {
                sh(script: './mvnw --batch-mode package -DskipTests')
            }
            }
    }
  post {
    always {
      junit(testResults: 'target/surefire-reports/*.xml', allowEmptyResults : true)
    }
  }
}